YUI.add("rg-capslock-detector",function(a){a.namespace("rg.plugins"),a.rg.plugins.CapsLockDetector=a.Base.create("CapsLockDetector",a.Plugin.Base,[],{pwField:null,initializer:function(){this.pwField=this.get("host"),this.setUpCapsLockWarningToolTip(),this.pwField.on("blur",this.hideCapsLockIcon,this),this.pwField.plug(a.rg.form.DelayedObserverPlugin,{ctx:this,fn:this.checkCapsLock,delay:.1})},setUpCapsLockWarningToolTip:function(){this.pwField.wrap('<div class="capslock-indicator-wrapper"></div>'),this.iconNode=a.Node.create('<span class="ico-caps-lock js-rg-capslock-detector" style="display: none;"></span>'),this.iconNode.insert(this.iconNode,this.get("host")),this.iconNode.plug(a.rg.widget.TooltipPlugin,{content:"Caps-lock enabled",align:"right",additionalClasses:"login-info-tooltip",renderTarget:this.pwField.get("parent")})},checkCapsLock:function(){b.isOn()?this.iconNode.show():this.hideCapsLockIcon()},hideCapsLockIcon:function(){this.iconNode.tooltip.hide(),this.iconNode.hide()}},{NS:"CapsLockDetector"});var b=function(){function a(){return d}function b(a){e.push(a)}function c(a){a||(a=window.event);var b=d,c=a.charCode?a.charCode:a.keyCode;if(c>=97&&122>=c?d=a.shiftKey:!(c>=65&&90>=c)||a.shiftKey&&f||(d=!a.shiftKey),d!=b)for(var g=0;g<e.length;g++)e[g](d)}var d=!1,e=[],f=/Mac/.test(navigator.platform);return window.addEventListener?window.addEventListener("keypress",c,!1):document.documentElement.attachEvent("onkeypress",c),{isOn:a,addListener:b}}()});
YUI.add("rg.views.application.HeaderLoginView",function(a){a.namespace("rg.views.application"),a.rg.views.application.HeaderLoginView=a.Base.create("application.HeaderLoginView",a.rg.WidgetView,[],{events:{".js-forgot-password":{click:"_forgotPassword"},".js-login-form":{submit:"deactivateSubmitButton"},global:{"HeaderLoginView:showLoginPanel":"showLoginPanel"},".js-fb-login":{click:"addUrlAfterLogin"},".js-lnkin-login":{click:"addUrlAfterLogin"}},afterRendered:function(){var b=this.get("container"),c=b.one(".dropdown"),d=this;b.one(".js-login-url").on("click",function(a){a.preventDefault()}),c.plug(a.rg.plugin.DropdownPlugin,{ignoreInsideClick:!0,callbackOnOpen:function(){a.rg.ajax("application.AjaxCommon.ajaxScoreGoal.html",{goal:d.get("goal")}),b.one(".login").focus()}}),this.addInfoTooltip()},addInfoTooltip:function(){var b=this.get("container"),c=b.one(".js-info");c&&c.plug(a.rg.widget.TooltipPlugin,{content:"<b>Tip:</b> Most researchers use their institutional email address as their ResearchGate login. ",align:"top",width:250,overlayOffset:[90,0],arrowOffset:[-30,0],additionalClasses:"login-info-tooltip"})},deactivateSubmitButton:function(){this.get("container").one(".js-submit-button").addClass("btn-disabled")},showLoginPanel:function(){var a=this.get("container"),b=a.one(".dropdown");b&&b.dropdownPlugin&&b.dropdownPlugin._openDropdown()},_forgotPassword:function(a){var b=a.currentTarget,c=this.get("container"),d=c.one("#input-header-login").get("value"),e=b.getAttribute("href");a.preventDefault(),this._attachAndContinue("email",d,e)},addUrlAfterLogin:function(a){var b=a.currentTarget,c=b.getAttribute("href"),d=a.currentTarget.getData("redirect-url");a.preventDefault(),this._attachAndContinue("urlAfterLogin",d,c)},_attachAndContinue:function(b,c,d){c&&d.match(/\?/)?d+="&"+b+"="+encodeURIComponent(c):c&&(d+="?"+b+"="+encodeURIComponent(c)),a.rg.utils.url.forwardTo(d)}},{ATTRS:{goal:{}}})},"1.0.0",{requires:["rg-dropdown-plugin","rg-utils-url","rg-capslock-detector"]});
